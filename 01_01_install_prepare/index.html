<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://Subaru-PFS.github.io/pfs_helpdesk_tutorial/01_01_install_prepare/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Preparation - PFS Pipe2D</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/pfs.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Preparation";
        var mkdocs_page_input_path = "01_01_install_prepare.md";
        var mkdocs_page_url = "/pfs_helpdesk_tutorial/01_01_install_prepare/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../img/logo.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Introduction</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">PFS Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../00_01_pfs_pipeline/">PFS 2D Pipeline</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Installation</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Preparation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#supported-machines-and-environments">Supported Machines and Environments</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#setup-directory">Setup Directory</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#install-dependencies">Install Dependencies</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../01_02_install_pipe2d/">Install 2D DRP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../01_03_integration_test/">Integration Test</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Run 2D DRP</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../02_01_run_prepare/">Preparation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../02_02_run_ingestion/">Data Ingestion</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../02_03_run_calib/">(Optional) Build Calibs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../02_04_run_science/">Procees Science Data</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Data Analysis</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../03_01_ana_file/">File Access</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../03_02_ana_visit/">Analyze Visit-level Data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../03_03_ana_coadd/">Analyze Coadd-level Data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../03_04_ana_1d/">Run 1D DRP</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Q&A</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../04_00_faq_general/">General</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../04_01_faq_install/">Install 2D DRP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../04_02_faq_run/">Run 2D DRP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../04_03_faq_analysis/">Data Analysis</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendix</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../05_01_app_datamodel/">Data Model</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">PFS Pipe2D</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Installation</li>
      <li class="breadcrumb-item active">Preparation</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/Subaru-PFS/pfs_helpdesk_tutorial/edit/master/docs/01_01_install_prepare.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="preparation">Preparation</h1>
<h2 id="supported-machines-and-environments">Supported Machines and Environments</h2>
<p>The current Gen3 2D DRP is supported on <code>CentOS 7</code> and <code>AlmaLinux 9</code> (recommended) with a <code>Bash</code> environment. A Python version of &ge; <code>3.9</code> is required (&ge; <code>3.11</code> is recommended). </p>
<p>Support for additional systems may be added in the future.</p>
<h2 id="setup-directory">Setup Directory</h2>
<hr />
<p>We assume that the working directory is <code>$WORKDIR/(username)/</code>.</p>
<p>First, we will need to create a folder for necessary dependencies.</p>
<pre><code>$ mkdir $WORKDIR/(username)/bin
</code></pre>
<p>Then, to set up the default environment variable, we should add the following line to <code>~/.bashrc</code></p>
<pre><code>$ export PATH=$WORKDIR/(username)/bin:$PATH
</code></pre>
<h2 id="install-dependencies">Install Dependencies</h2>
<hr />
<p><strong>Step 1</strong>: Fetch a tool of <code>yum</code></p>
<p>There is a useful tool for installing dependencies in local environments: <a href="https://gitlab.com/caroff/user-yum.sh">user-yum</a>.
It installs applications conveniently without the root privilege in <code>CentOS 7</code>.</p>
<pre><code>$ cd $WORKDIR/(username)/bin
$ git clone https://gitlab.com/caroff/user-yum.sh.git
</code></pre>
<p>You will find it handy if you change <code>Makefile</code> line 40 from
<code>INSTALL_FLAG_PREFIX := +</code> to <code>INSTALL_FLAG_PREFIX :=</code></p>
<p>Then insert the following lines to <code>~/.bash_profile</code>:</p>
<pre><code class="language-bash"># Setting environment for $WORKDIR/(username)/bin/user-yum.sh/root
ROOT_D=&quot;$WORKDIR/(username)/bin/user-yum.sh/root&quot;
export PATH=$ROOT_D/usr/sbin:$ROOT_D/usr/bin:$ROOT_D/bin:$PATH
L=&quot;/lib:/lib64:/usr/lib:/usr/lib64&quot;
export LD_LIBRARY_PATH=$L:$ROOT_D/usr/lib:$ROOT_D/usr/lib64:$LD_LIBRARY_PATH
</code></pre>
<div class="admonition note user-yum">
<p class="admonition-title">Note</p>
<p>If you are the administrator of your local machine, you may skip this step and directly install the below dependencies with <code>sudo yum install ***</code>.</p>
</div>
<p><strong>(Skippable for the latest LSST v28) Step 2</strong>: Install dependencies using <code>user-yum.sh</code></p>
<pre><code>$ cd user-yum.sh/
$ make blas bzip2-devel cmake freetype-devel gcc-c++ gcc-gfortran glib2-devel libuuid-devel libXt-devel ncurses-devel openssl-devel readline-devel zlib-dev
$ make install
</code></pre>
<p><strong>(Skippable for the latest LSST v28) Step 3</strong>: Install OpenBLAS</p>
<p>OpenBLAS is needed for pfs_pipe2d; however it cannot be found in the default repositories of <code>CentOS 7</code>.
(From <a href="https://gist.github.com/bmmalone/1b5f9ff72754c7d4b313c0b044c42684">this page</a>)</p>
<pre><code>$ cd $WORKDIR/(username)/bin
$ git clone https://github.com/OpenMathLib/OpenBLAS.git --single-branch --branch=v0.3.28
$ cd OpenBLAS &amp;&amp; make FC=gfortran
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If compilation fails due to missing dependencies, proceed with the LSST framework installation and retry this step afterward. You will probably manage to install the LSST platform and fail at the installation of PFS packages. Use command <code>source $WORKDIR/(username)/packages/stack_(LSST version)/loadLSST.bash</code> and then come back to repeat the last line listed above. The last step is setting up environment variables in <code>~/.bash_profile</code></p>
</div>
<p>Then, to set up the default environment variable, we can add the following lines to <code>~/.bash_profile</code></p>
<pre><code># for the OpenBLAS library
export LD_LIBRARY_PATH=$WORKDIR/(username)/bin/OpenBLAS:$LD_LIBRARY_PATH
export BLAS=$WORKDIR/(username)/bin/libopenblas.a
export ATLAS=$WORKDIR/(username)/bin/libopenblas.a
</code></pre>
<p><strong>Step 4</strong>: Install git LFS</p>
<p>Git LFS must be installed to download large files from Git.</p>
<pre><code>$ cd $WORKDIR/(username)/bin
$ wget https://github.com/git-lfs/git-lfs/releases/download/v3.5.1/git-lfs-linux-amd64-v3.5.1.tar.gz
$ tar xzf git-lfs-linux-amd64-v3.5.1.tar.gz
$ cd git-lfs-3.5.1
$ PREFIX=$WORKDIR/(username) ./install.sh
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../00_01_pfs_pipeline/" class="btn btn-neutral float-left" title="PFS 2D Pipeline"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../01_02_install_pipe2d/" class="btn btn-neutral float-right" title="Install 2D DRP">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/Subaru-PFS/pfs_helpdesk_tutorial" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../00_01_pfs_pipeline/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../01_02_install_pipe2d/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
